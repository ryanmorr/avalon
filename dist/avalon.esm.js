/*! @ryanmorr/avalon v0.1.0 | https://github.com/ryanmorr/avalon */function _typeof3(a){"@babel/helpers - typeof";return _typeof3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof3(a)}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _iterableToArrayLimit(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var n=function(b,c,d,f){var e;c[0]=0;for(var g=1;g<c.length;g++){var i=c[g++],j=c[g]?(c[0]|=i?1:2,d[c[g++]]):c[++g];3===i?f[0]=j:4===i?f[1]=Object.assign(f[1]||{},j):5===i?(f[1]=f[1]||{})[c[++g]]=j:6===i?f[1][c[++g]]+=j+"":i?(e=b.apply(j,n(b,j,d,["",null])),f.push(e),j[0]?c[0]|=2:(c[g-2]=0,c[g]=e)):f.push(j)}return f},t=new Map;function htm(a){var b=t.get(this);return b||(b=new Map,t.set(this,b)),1<(b=n(this,b.get(a)||(b.set(a,b=function(b){for(var c,d,f=1,g="",i="",j=[0],k=function(a){1===f&&(a||(g=g.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?j.push(0,a,g):3===f&&(a||g)?(j.push(3,a,g),f=2):2===f&&"..."===g&&a?j.push(4,a,0):2===f&&g&&!a?j.push(5,0,!0,g):5<=f&&((g||!a&&5===f)&&(j.push(f,0,g,d),f=6),a&&(j.push(f,a,0,d),f=6)),g=""},m=0;m<b.length;m++){m&&(1===f&&k(),k(m));for(var n=0;n<b[m].length;n++)c=b[m][n],1===f?"<"===c?(k(),j=[j],f=3):g+=c:4===f?"--"===g&&">"===c?(f=1,g=""):g=c+g[0]:i?c===i?i="":g+=c:"\""===c||"'"===c?i=c:">"===c?(k(),f=1):f&&("="===c?(f=5,d=g,g=""):"/"===c&&(5>f||">"===b[m][n+1])?(k(),3===f&&(j=j[0]),f=j,(j=j[0]).push(2,0,f),f=0):" "===c||"\t"===c||"\n"===c||"\r"===c?(k(),f=2):g+=c),3===f&&"!--"===g&&(f=4,j=j[0])}return k(),j}(a)),b),arguments,[])).length?b:b[0]}/*! @ryanmorr/carbon v0.1.0 | https://github.com/ryanmorr/carbon */function _typeof2(b){return _typeof2="function"==typeof Symbol&&"symbol"==_typeof3(Symbol.iterator)?function(b){return _typeof3(b)}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":_typeof3(b)},_typeof2(b)}function _typeof$1(b){return _typeof$1="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(b){return _typeof2(b)}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":_typeof2(b)},_typeof$1(b)}function _toConsumableArray(b){return _arrayWithoutHoles(b)||_iterableToArray(b)||_nonIterableSpread()}function _arrayWithoutHoles(d){if(Array.isArray(d)){for(var a=0,e=Array(d.length);a<d.length;a++)e[a]=d[a];return e}}function _iterableToArray(b){if(Symbol.iterator in Object(b)||"[object Arguments]"===Object.prototype.toString.call(b))return Array.from(b)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var ELEMENT_NODE=1,TEXT_NODE=3;function flatten(d){for(var a,e=0;e<d.length;)a=d[e],Array.isArray(a)?0<a.length?(a.unshift(e,1),d.splice.apply(d,a),a.splice(0,2)):d.splice(e,1):e++;return d}function createClass(g){var a="";if("string"==typeof g)return g;if(Array.isArray(g)&&0<g.length)for(var h,i=0,j=g.length;i<j;i++)""!==(h=createClass(g[i]))&&(a+=(a&&" ")+h);else for(var e in g)g[e]&&(a+=(a&&" ")+e);return a}function merge(){for(var d=arguments.length,a=Array(d),b=0;b<d;b++)a[b]=arguments[b];return Object.assign.apply(Object,[{}].concat(a))}function getKey(b){return b.attributes&&b.attributes.key||null}function isValidNodeType(b){return null!=b&&"boolean"!=typeof b}function isSameNode(b,c){return b.nodeName===c.nodeName&&getKey(b)===getKey(c)}function isSameNodeType(b,c){return b.nodeType===c.nodeType&&(b.nodeType!==TEXT_NODE||b.text===c.text)&&b.nodeName===c.nodeName}function createKeyToIndexMap(h,a,b){for(var c={},d=a;d<=b;++d){var i=h[d],f=i&&getKey(i);null!=f&&(c[f]=d)}return c}function getVNode(c){var a=_typeof$1(c);return"boolean"===a?null:"string"===a||"number"===a?createTextVNode(c):Array.isArray(c)?flatten(c).reduce(function(c,a){return isValidNodeType(a)&&c.push(getVNode(a)),c},[]):c}function recycle(f){return 3===f.nodeType?createTextVNode(f.data,f):1===f.nodeType?createVNode(f.nodeName.toLowerCase(),Array.from(f.attributes).reduce(function(a,b){var c=b.name,d=b.value;return"style"!==c&&(a[c]=d),"key"===c&&f.removeAttribute("key"),a},{}),Array.from(f.childNodes).map(recycle),f):void 0}function createVNode(e,a,b){var c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{nodeType:ELEMENT_NODE,node:c,nodeName:e,attributes:a,children:b}}function createTextVNode(c){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return{nodeType:TEXT_NODE,node:a,text:c}}function createElement(f){var g,h=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(f.nodeType===TEXT_NODE)g=document.createTextNode(f.text);else{var a=f.nodeName;h=h||"svg"===a,g=h?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a);var d=f.attributes;Object.keys(d).forEach(function(b){return patchAttribute(g,b,null,d[b],h)}),f.children.forEach(function(b){return g.appendChild(createElement(b,h))})}return f.node=g,g}function patchAttribute(h,a,i,c){var j=!!(4<arguments.length&&void 0!==arguments[4])&&arguments[4];if("key"!==a&&"children"!==a)if(j?"className"===a&&(a="class"):"class"===a&&(a="className"),("class"===a||"className"===a)&&(c=createClass(c)),"style"!==a)a.startsWith("on")&&("function"==typeof i||"function"==typeof c)?(a=a.slice(2).toLowerCase(),c&&h.addEventListener(a,c),i&&h.removeEventListener(a,i)):!j&&"list"!==a&&"form"!==a&&a in h?h[a]=null==c?"":c:null==c||!1===c?h.removeAttribute(a):"function"!=typeof c&&h.setAttribute(a,c);else if("string"==typeof c)h.style.cssText=c;else for(var e in merge(c,i)){var f=null==c||null==c[e]?"":c[e];e.includes("-")?h.style.setProperty(e,f):h.style[e]=f}}function patchChildren(i,a,b,c){for(var d,v=0,w=a.length-1,x=a[0],y=a[w],z=0,A=b.length-1,B=b[0],C=b[A];v<=w&&z<=A;)if(!x)x=a[++v];else if(!y)y=a[--w];else if(isSameNode(x,B))patchElement(i,x,B,c),x=a[++v],B=b[++z];else if(isSameNode(y,C))patchElement(i,y,C,c),y=a[--w],C=b[--A];else if(isSameNode(x,C))patchElement(i,x,C,c),i.insertBefore(x.node,y.node.nextSibling),x=a[++v],C=b[--A];else if(isSameNode(y,B))patchElement(i,y,B,c),i.insertBefore(y.node,x.node),y=a[--w],B=b[++z];else{d||(d=createKeyToIndexMap(a,v,w));var D=getKey(B),o=D?d[D]:null;if(null==o)i.insertBefore(createElement(B,c),x.node),B=b[++z];else{var p=a[o];patchElement(i,p,B,c),a[o]=void 0,i.insertBefore(p.node,x.node),B=b[++z]}}if(v>w)for(var q=b[A+1]?b[A+1].node:null,r=z;r<=A;r++)i.insertBefore(createElement(b[r],c),q);else if(z>A)for(var E,F=v;F<=w;F++)E=a[F],E&&E.node&&i.removeChild(E.node);return b}function patchElement(k,a,b){var c=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];if(a===b)return null==a?null:a.node;if(null==a)return k.appendChild(createElement(b,c));var l=a.node;if(null==b)return k.removeChild(l)&&null;if(a.nodeType===TEXT_NODE&&b.nodeType===TEXT_NODE)a.text!==b.text&&(l.data=b.text);else if(!isSameNodeType(b,a)){var m=createElement(b,c);k.replaceChild(m,l),l=m}else{c=c||"svg"===b.nodeName;var f=document.activeElement,g=a.attributes,h=b.attributes;for(var i in merge(h,g))("value"==i||"selected"===i||"checked"===i?l[i]:g[i])!==h[i]&&patchAttribute(l,i,g[i],h[i],c);patchChildren(l,a.children,b.children,c),f.focus()}return b.node=l,l}function h(g,a){for(var h=arguments.length,c=Array(2<h?h-2:0),i=2;i<h;i++)c[i-2]=arguments[i];if(!a||a.nodeType||"function"==typeof a.concat){var j;c=(j=[]).concat.apply(j,[a||[]].concat(_toConsumableArray(c))),a={}}return createVNode(g,a||{},getVNode(c))}function render(g,a){a=getVNode(a);var h=g.vdom||(0<g.childNodes.length?Array.from(g.childNodes).map(recycle):null),i=Array.isArray(h),d=Array.isArray(a);if(g.vdom=a,i||d){h=(i?h:[h]).filter(isValidNodeType),a=(d?a:[a]).filter(isValidNodeType);var e=patchChildren(g,h,a);return 0===e.length?null:1===e.length?e[0].node:e.map(function(b){return b.node})}return patchElement(g,h,a)}/*! @ryanmorr/schedule-render v2.0.1 | https://github.com/ryanmorr/schedule-render */var frame,budget=null,batch=[];function render$1(){for(frame=null;0<batch.length;)batch.shift().render()}function scheduleRender(c){return new Promise(function(a,b){frame||(frame=requestAnimationFrame(render$1)),batch.push({render:function(){return a(c())},cancel:b})})}var TRAILING_SLASH_RE=/\/$/;function isNumeric(a){return!Number.isNaN(parseFloat(a))&&isFinite(a)}function coerce(a){return!("true"!==a)||"false"!==a&&("undefined"===a?null:isNumeric(a)?+a:a)}function isPlainObject(a){if(!a||"object"!==_typeof(a))return!1;var b=Object.getPrototypeOf(a);return null===b||b===Object.getPrototypeOf({})}function deepFreeze(a){return null==a||Object.isFrozen(a)?a:(Object.freeze(a),Array.isArray(a)?a.forEach(function(a){return deepFreeze(a)}):isPlainObject(a)&&Object.getOwnPropertyNames(a).forEach(function(b){return deepFreeze(a[b])}),a)}function createStateObject(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return deepFreeze(Object.assign.apply(Object,[Object.create(null)].concat(b)))}function isPath(a){return"/"===a.charAt(0)}function isSameOrigin(a){var b=new URL(a,window.location.toString()),c=window.location;return c.protocol===b.protocol&&c.hostname===b.hostname&&(c.port===b.port||""===c.port&&(80==b.port||443==b.port))}function normalizePath(a){return a=a.trim(),"/"===a?a:a.replace(TRAILING_SLASH_RE,"")}function addOneOrMany(a,b,c){if(isPlainObject(a))for(var d in a)c(d,a[d]);else c(a,b)}function isEqual(c,a){if(c===a)return!0;if(null===c||null===a)return!1;var b=Object.prototype.toString.call(c),d=Object.prototype.toString.call(a);if(b!=d)return!1;switch(b){case"[object Date]":case"[object Number]":return+c==+a||+c!=+c&&+a!=+a;case"[object Function]":case"[object String]":case"[object Boolean]":return""+c==""+a;case"[object Array]":if(c.length!=a.length)return!1;for(var e=0;e<c.length;e++)if(!isEqual(c[e],a[e]))return!1;return!0;case"[object Object]":{var f=Object.keys(c),g=Object.keys(a);return f.length==g.length&&f.every(function(b){return isEqual(c[b],a[b])})}default:return!1;}}function getRouteMatcher(a){var b=[],c=a.split("/").map(function(a){if(!a)return a;var c=a.length,d=a.charCodeAt(0);if(42===d)return b.push("wildcard"),"/(.*)";if(58===d){var e=63===a.charCodeAt(c-1);return b.push(a.substring(1,e?c-1:c)),e?"(?:/([^/]+?))?":"/([^/]+?)"}return"/"+a}),d=new RegExp("^"+c.join("")+"/?$","i");return function(a){var c=d.exec(a);return c&&c[0]?c.slice(1).map(decodeURI).map(coerce).reduce(function(a,c,d){return a[b[d]]=c,a},{}):null}}var Avalon=/*#__PURE__*/function(){function a(){var b=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,a),"title"in c?document.title=c.title:c.title=document.title,this._state=createStateObject(c),this._mutations=Object.create(null),this._actions=new Map,this._events=new Map,this._dispatchers=new Map,this._views=[],this._commit=this.commit.bind(this),this._dispatch=this.dispatch.bind(this),this._redirect=this.redirect.bind(this),this._navigate=this.navigate.bind(this),this._emit=this.emit.bind(this);var d=this._handleEvent.bind(this);document.documentElement.addEventListener("click",d,!1),document.documentElement.addEventListener("submit",d,!1),this.html=htm.bind(function(a,c){c=c||{};for(var d=arguments.length,e=Array(2<d?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];return"function"==typeof a?(c.children=e,a(b.html,c,b._getEventDispatcher())):h.apply(void 0,[a,c].concat(e))}),this.on("mutation",function(a,c,d){c.title!==d.title&&(document.title=c.title),b._views.forEach(function(a){return a()})})}return _createClass(a,[{key:"use",value:function(a){return a(this,this.state())}},{key:"state",value:function(){return this._state}},{key:"path",value:function(){return normalizePath(window.location.pathname)}},{key:"on",value:function(a,b){var c=this,d=this._events.get(a);return void 0===d&&(d=new Set,this._events.set(a,d)),d.add(b),function(){return c._events.get(a)["delete"](b)}}},{key:"emit",value:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=this._events.get(a);void 0!==e&&0<e.size&&e.forEach(function(a){return a.apply(void 0,c)})}},{key:"mutation",value:function(a,b){var c=this;addOneOrMany(a,b,function(a,b){c._mutations[a]=b})}},{key:"commit",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=this._mutations[a];if(c){var d=this.state(),e=c(d,b);return this._state=createStateObject(d,e),this.emit("mutation",a,this._state,d,e),e}return null}},{key:"action",value:function(a,b){var c=this;addOneOrMany(a,b,function(a,b){c._actions.set(a,b)})}},{key:"route",value:function(a,b){var c=this;this._onPopState||(this._onPopState=this._handlePopState.bind(this),window.addEventListener("popstate",this._onPopState,!1)),addOneOrMany(a,b,function(a,b){c._actions.set(getRouteMatcher(a),b)})}},{key:"dispatch",value:function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.path(),c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=this._getDispatcher(b,c);return a?a():null}},{key:"navigate",value:function(a){return this._modifyHistory(a,"navigate")}},{key:"redirect",value:function(a){return this._modifyHistory(a,"redirect")}},{key:"view",value:function(a,b){var c=this;"string"==typeof a&&(a=document.querySelector(a));var d,e=function(){return d?d:d=scheduleRender(function(){var e=b(c.html,c.state(),c._getEventDispatcher()),f=render(a,e);d=null,c.emit("render",f)})};this._views.push(e),e()}},{key:"_modifyHistory",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"navigate";if(a=normalizePath(a),a!==this.path()){var c=this._getDispatcher(a);return c?(history["redirect"===b?"replaceState":"pushState"](null,"",a),this.emit("pathchange",a),c()):null}}},{key:"_getDispatcher",value:function(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=!0,f=!1,g=void 0;try{for(var h,i,j=function(){var e=_slicedToArray(h.value,2),f=e[0],g=e[1],i=void 0;if(isPath(a)&&"string"!=typeof f){var j=normalizePath(a);c=f(j),c&&(i="route",0===Object.keys(c).length&&(c=null))}else f===a&&(i="action");return i?{v:function(){var e={params:c,event:d,state:b.state(),commit:b._commit,dispatch:b._dispatch,navigate:b._navigate,redirect:b._redirect,emit:b._emit};"route"===i&&(e.path=a);var f=2>g.length?g(e):new Promise(function(a,b){return g(e,a,b)});return b.emit("dispatch",i,a,b.state(),c,d,f),f}}:void 0},k=this._actions[Symbol.iterator]();!(e=(h=k.next()).done);e=!0)if(i=j(),"object"===_typeof(i))return i.v}catch(a){f=!0,g=a}finally{try{e||null==k["return"]||k["return"]()}finally{if(f)throw g}}return null}},{key:"_getEventDispatcher",value:function(){var a=this;return function(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=!0,e=!1,f=void 0;try{for(var g,h=a._dispatchers[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=_slicedToArray(g.value,2),j=i[0],k=i[1];if(j[0]===b&&isEqual(c,j[1]))return k}}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}var l=function(d){var e=a._getDispatcher(b,c,d instanceof Event?d:null);return e?e():null};return a._dispatchers.set([b,c],l),l}}},{key:"_handlePopState",value:function(){var a=this.path();this.dispatch(a),this.emit("pathchange",a)}},{key:"_handleEvent",value:function(a){if(!a.defaultPrevented){var b;if("submit"===a.type)b=a.target.getAttribute("action");else{if(a.button||a.ctrlKey||a.metaKey||a.altKey||a.shiftKey)return;var c=a.target.closest("a");if(!c)return;var d="object"===_typeof(c.href)&&"SVGAnimatedString"===c.href.constructor.name;if("_blank"===c.getAttribute("target"))return;if("external"===c.getAttribute("rel"))return;if(c.hasAttribute("download"))return;if(!d&&!isSameOrigin(c))return;if(b=d?c.href.baseVal:c.getAttribute("href"),-1<b.indexOf("mailto:"))return}if(b){var e=isPath(b);if(e&&(b=normalizePath(b)),!(e&&b===this.path())){var f=this._getDispatcher(b,null,a);f&&(a.preventDefault(),e&&(history.pushState(null,"",b),this.emit("pathchange",b)),f())}}}}}]),a}();function avalon(a){return new Avalon(a)}export default avalon;
